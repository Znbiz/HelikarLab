ccNetViz=function(e,t){function i(t){var i=e.getBoundingClientRect(),r=Math.min(1,l.size*(1+.001*(t.deltaMode?33:1)*t.deltaY)),n=r-l.size;l.size=r,l.x=Math.max(0,Math.min(1-r,l.x-n*(t.clientX-i.left)/e.width)),l.y=Math.max(0,Math.min(1-r,l.y-n*(1-(t.clientY-i.top)/e.height))),this.draw(),t.preventDefault()}function r(t){var i=e.width/l.size,r=e.height/l.size,n=l.x+t.clientX/i,o=t.clientY/r-l.y,c=function(e){l.x=Math.max(0,Math.min(1-l.size,n-e.clientX/i)),l.y=Math.max(0,Math.min(1-l.size,e.clientY/r-o)),this.draw(),e.preventDefault()}.bind(this),a=function(){window.removeEventListener("mouseup",a),window.removeEventListener("mousemove",c)};window.addEventListener("mouseup",a),window.addEventListener("mousemove",c)}function n(){var t={depth:!1,antialias:!1};return e.getContext("webgl",t)||e.getContext("experimental-webgl",t)}function o(){return{elements:[],add:function(e,t){g[e]=t,g.elements.push(t)}}}t=t||{},t.styles=t.styles||{};var c=t.styles.background=t.styles.background||{},a=new ccNetViz.color(c.color||"rgb(255, 255, 255)"),s=t.styles.node=t.styles.node||{};if(s.minSize=null!=s.minSize?s.minSize:6,s.maxSize=s.maxSize||16,s.color=s.color||"rgb(255, 255, 255)",s.label){var u=s.label;u.color=u.color||"rgb(120, 120, 120)",u.font=u.font||"11px Arial, Helvetica, sans-serif"}var f=t.styles.edge=t.styles.edge||{};if(f.width=f.width||1,f.color=f.color||"rgb(204, 204, 204)",f.arrow){var u=f.arrow;u.minSize=null!=u.minSize?u.minSize:6,u.maxSize=u.maxSize||12,u.aspect=1}var v=.5*s.maxSize;this.set=function(e,i,r){this.nodes=e=e||[],this.edges=i=i||[];var n=[],o=[],c=[],a=function(){for(var t=0;t<e.length;t++)e[t].index=t;if(m.OES_standard_derivatives){for(var r={},t=0;t<i.length;t++){var a=i[t];(r[a.source.index]||(r[a.source.index]={}))[a.target.index]=!0}for(var t=0;t<i.length;t++){var s,a=i[t];if(a.source.index===a.target.index)s=c;else{var u=r[a.target.index];s=u&&u[a.source.index]?o:n}s.push(a)}}else for(var t=0;t<i.length;t++){var a=i[t];a.source.index!==a.target.index&&n.push(a)}},u=function(e,t){var i=t.x-e.x,r=t.y-e.y,n=1/Math.sqrt(i*i+r*r);return{x:n*i,y:n*r}};if(a(),r&&new ccNetViz.layout[r](e,i).apply()&&ccNetViz.layout.normalize(e),g.nodes.set(d,t.styles,h,e.length&&!e[0].color?e:[],function(e){return{set:function(e,t,i,r){var n=t.x,o=t.y;ccNetViz.primitive.vertices(e.position,i,n,o,n,o,n,o,n,o),ccNetViz.primitive.vertices(e.textureCoord,i,0,0,1,0,1,1,0,1),ccNetViz.primitive.quad(e.indices,i,r)}}}),g.nodesColored.set(d,t.styles,h,e.length&&e[0].color?e:[],function(e){return{set:function(e,t,i,r){var n=t.x,o=t.y,c=t.color;ccNetViz.primitive.vertices(e.position,i,n,o,n,o,n,o,n,o),ccNetViz.primitive.vertices(e.textureCoord,i,0,0,1,0,1,1,0,1),ccNetViz.primitive.colors(e.color,i,c,c,c,c),ccNetViz.primitive.quad(e.indices,i,r)}}}),s.label&&(x.clear(),g.labels.set(d,t.styles,h,e,function(e){return x.setFont(e.font),e.texture=x.texture,{set:function(e,t,i,r){var n=t.x,o=t.y;ccNetViz.primitive.vertices(e.position,i,n,o,n,o,n,o,n,o);var c=x.get(t.label),a=.5>=n?0:-c.width,s=.5>=o?0:-c.height;ccNetViz.primitive.vertices(e.relative,i,a,s,c.width+a,s,c.width+a,c.height+s,a,c.height+s),ccNetViz.primitive.vertices(e.textureCoord,i,c.left,c.bottom,c.right,c.bottom,c.right,c.top,c.left,c.top),ccNetViz.primitive.quad(e.indices,i,r)}}}),x.bind()),g.lines.set(d,t.styles,h,n,function(e){return{set:function(e,t,i,r){var n=t.source,o=t.target,c=u(n,o);ccNetViz.primitive.vertices(e.position,i,n.x,n.y,n.x,n.y,o.x,o.y,o.x,o.y),ccNetViz.primitive.vertices(e.normal,i,-c.y,c.x,c.y,-c.x,c.y,-c.x,-c.y,c.x),ccNetViz.primitive.quad(e.indices,i,r)}}}),m.OES_standard_derivatives&&(g.curves.set(d,t.styles,h,o,function(e){return{numVertices:3,numIndices:3,set:function(e,t,i,r){var n=t.source,o=t.target,c=u(n,o);ccNetViz.primitive.vertices(e.position,i,n.x,n.y,.5*(o.x+n.x),.5*(o.y+n.y),o.x,o.y),ccNetViz.primitive.vertices(e.normal,i,0,0,c.y,-c.x,0,0),ccNetViz.primitive.vertices(e.curve,i,1,1,.5,0,0,0),ccNetViz.primitive.indices(e.indices,i,r,0,1,2)}}}),g.circles.set(d,t.styles,h,c,function(e){return{set:function(e,t,i,r){var n=t.source,o=n.y<.5?1:-1;ccNetViz.primitive.vertices(e.position,i,n.x,n.y,n.x,n.y,n.x,n.y,n.x,n.y),ccNetViz.primitive.vertices(e.normal,i,0,0,1,o,0,1.25*o,-1,o),ccNetViz.primitive.vertices(e.curve,i,1,1,.5,0,0,0,.5,0),ccNetViz.primitive.quad(e.indices,i,r)}}})),f.arrow){var v=function(e,t,i,r,n,o){var c=t.target.x,a=t.target.y;ccNetViz.primitive.vertices(e.position,i,c,a,c,a,c,a,c,a),ccNetViz.primitive.vertices(e.direction,i,n,o,n,o,n,o,n,o),ccNetViz.primitive.vertices(e.textureCoord,i,0,0,1,0,1,1,0,1),ccNetViz.primitive.quad(e.indices,i,r)};if(g.lineArrows.set(d,t.styles,h,n,function(e){return{set:function(e,t,i,r){var n=u(t.source,t.target);v(e,t,i,r,n.x,n.y)}}}),m.OES_standard_derivatives){g.curveArrows.set(d,t.styles,h,o,function(e){return{set:function(e,t,i,r){return v(e,t,i,r,.5*(t.target.x-t.source.x),.5*(t.target.y-t.source.y))}}});var l=Math.cos(.9),p=Math.sin(.9);g.circleArrows.set(d,t.styles,h,c,function(e){return{set:function(e,t,i,r){return v(e,t,i,r,t.target.x<.5?l:-l,t.target.y<.5?-p:p)}}})}}},this.update=function(e,t,i){g[e].update(d,t,i,function(e){return{set:function(e,t,i){return ccNetViz.primitive.colors(e,i,t,t,t,t)}}})},this.draw=function(){var t=e.width,i=e.height,r=t/i,n=1===l.size?v:0,o=n/t,c=n/i,a={transform:ccNetViz.gl.ortho(l.x-o,l.x+l.size+o,l.y-c,l.y+l.size+c,-1,1),width:.5*t,height:.5*i,aspect2:r*r,count:this.nodes.length};a.curveExc=p(a,this.edges.length,.5),a.style=s,a.nodeSize=y(a),d.viewport(0,0,t,i),d.clear(d.COLOR_BUFFER_BIT),g.elements.forEach(function(e){return e.draw(a)})}.bind(this),this.resize=function(){e.width=e.offsetWidth,e.height=e.offsetHeight},this.resetView=function(){l.size=1,l.x=l.y=0},this.image=function(){return e.toDataURL()},this.resize(),this.nodes=[],this.edges=[];var l={};this.resetView();var d=n(),m=ccNetViz.gl.initExtensions(d,"OES_standard_derivatives"),h=new ccNetViz.textures(t.onLoad||this.draw),x=new ccNetViz.texts(d),g=o.call(this),p=function(e,t,i){var r=i*Math.sqrt(e.width*e.height/t)/l.size,n=e.style;return n&&(r=n.maxSize?Math.min(n.maxSize,r):r,r=r<n.hideSize?0:n.minSize?Math.max(n.minSize,r):r),r},y=function(e){return p(e,this.nodes.length,.4)}.bind(this),z=["precision mediump float;","uniform vec4 color;","uniform sampler2D texture;","varying vec2 tc;","void main(void) {","   gl_FragColor = color * texture2D(texture, vec2(tc.s, tc.t));","}"],b=["precision mediump float;","uniform sampler2D texture;","varying vec2 tc;","varying vec4 c;","void main(void) {","   gl_FragColor = c * texture2D(texture, vec2(tc.s, tc.t));","}"],N=["#extension GL_OES_standard_derivatives : enable","#ifdef GL_ES","precision highp float;","#endif","uniform float width;","uniform vec4 color;","varying vec2 c;","void main(void) {","   vec2 px = dFdx(c);","   vec2 py = dFdy(c);","   float fx = 2.0 * c.x * px.x - px.y;","   float fy = 2.0 * c.y * py.x - py.y;","   float sd = (c.x * c.x - c.y) / sqrt(fx * fx + fy * fy);","   float alpha = 1.0 - abs(sd) / width;","   if (alpha < 0.0) discard;","   gl_FragColor = vec4(color.r, color.g, color.b, min(alpha, 1.0));","}"];if(g.add("lines",new ccNetViz.primitive(d,f,null,["attribute vec2 position;","attribute vec2 normal;","uniform vec2 width;","uniform mat4 transform;","varying vec2 n;","void main(void) {","   gl_Position = vec4(width * normal, 0, 0) + transform * vec4(position, 0, 1);","   n = normal;","}"],["precision mediump float;","uniform vec4 color;","varying vec2 n;","void main(void) {","   gl_FragColor = vec4(color.r, color.g, color.b, color.a - length(n));","}"],function(e){d.uniform2f(e.shader.uniforms.width,e.style.width/e.width,e.style.width/e.height),ccNetViz.gl.uniformColor(d,e.shader.uniforms.color,e.style.color)})),m.OES_standard_derivatives&&(g.add("curves",new ccNetViz.primitive(d,f,null,["attribute vec2 position;","attribute vec2 normal;","attribute vec2 curve;","uniform float exc;","uniform vec2 screen;","uniform float aspect2;","uniform mat4 transform;","varying vec2 c;","void main(void) {","   vec2 n = vec2(normal.x, aspect2 * normal.y);","   float length = length(screen * n);","   n = length == 0.0 ? vec2(0, 0) : n / length;","   gl_Position = vec4(exc * n, 0, 0) + transform * vec4(position, 0, 1);","   c = curve;","}"],N,function(e){d.uniform1f(e.shader.uniforms.width,e.style.width),d.uniform1f(e.shader.uniforms.exc,e.curveExc),d.uniform2f(e.shader.uniforms.screen,e.width,e.height),d.uniform1f(e.shader.uniforms.aspect2,e.aspect2),ccNetViz.gl.uniformColor(d,e.shader.uniforms.color,e.style.color)})),g.add("circles",new ccNetViz.primitive(d,f,null,["attribute vec2 position;","attribute vec2 normal;","attribute vec2 curve;","uniform vec2 size;","uniform mat4 transform;","varying vec2 c;","void main(void) {","   gl_Position = vec4(size * normal, 0, 0) + transform * vec4(position, 0, 1);","   c = curve;","}"],N,function(e){d.uniform1f(e.shader.uniforms.width,e.style.width);var t=2.5*e.nodeSize;d.uniform2f(e.shader.uniforms.size,t/e.width,t/e.height),ccNetViz.gl.uniformColor(d,e.shader.uniforms.color,e.style.color)}))),f.arrow){var E=function(e){var t=p(e,this.edges.length,.2);return t?(d.uniform1f(e.shader.uniforms.offset,.5*e.nodeSize),d.uniform2f(e.shader.uniforms.size,t,e.style.aspect*t),e.shader.uniforms.exc&&d.uniform1f(e.shader.uniforms.exc,.5*l.size*e.curveExc),d.uniform2f(e.shader.uniforms.screen,e.width,e.height),e.shader.uniforms.aspect2&&d.uniform1f(e.shader.uniforms.aspect2,e.aspect2),void ccNetViz.gl.uniformColor(d,e.shader.uniforms.color,e.style.color)):!0}.bind(this);g.add("lineArrows",new ccNetViz.primitive(d,f,"arrow",["attribute vec2 position;","attribute vec2 direction;","attribute vec2 textureCoord;","uniform float offset;","uniform vec2 size;","uniform vec2 screen;","uniform float aspect2;","uniform mat4 transform;","varying vec2 tc;","void main(void) {","   vec2 u = direction / length(screen * direction);","   vec2 v = vec2(u.y, -aspect2 * u.x);","   v = v / length(screen * v);","   gl_Position = vec4(size.x * (0.5 - textureCoord.x) * v - size.y * textureCoord.y * u - offset * u, 0, 0) + transform * vec4(position, 0, 1);","   tc = textureCoord;","}"],z,E)),m.OES_standard_derivatives&&(g.add("curveArrows",new ccNetViz.primitive(d,f,"arrow",["attribute vec2 position;","attribute vec2 direction;","attribute vec2 textureCoord;","uniform float offset;","uniform vec2 size;","uniform float exc;","uniform vec2 screen;","uniform float aspect2;","uniform mat4 transform;","varying vec2 tc;","void main(void) {","   vec2 u = normalize(vec2(direction.y, -aspect2 * direction.x));","   u = normalize(direction - exc * u / length(screen * u));","   u = u / length(screen * u);","   vec2 v = vec2(u.y, -aspect2 * u.x);","   v = v / length(screen * v);","   gl_Position = vec4(size.x * (0.5 - textureCoord.x) * v - size.y * textureCoord.y * u - offset * u, 0, 0) + transform * vec4(position, 0, 1);","   tc = textureCoord;","}"],z,E)),g.add("circleArrows",new ccNetViz.primitive(d,f,"arrow",["attribute vec2 position;","attribute vec2 direction;","attribute vec2 textureCoord;","uniform float offset;","uniform vec2 size;","uniform vec2 screen;","uniform mat4 transform;","varying vec2 tc;","void main(void) {","   vec2 u = direction;","   vec2 v = vec2(direction.y, -direction.x);","   gl_Position = vec4((size.x * (0.5 - textureCoord.x) * v - size.y * textureCoord.y * u - offset * u) / screen, 0, 0) + transform * vec4(position, 0, 1);","   tc = textureCoord;","}"],z,E)))}if(g.add("nodes",new ccNetViz.primitive(d,s,null,["attribute vec2 position;","attribute vec2 textureCoord;","uniform vec2 size;","uniform mat4 transform;","varying vec2 tc;","void main(void) {","   gl_Position = vec4(size * (textureCoord - vec2(0.5, 0.5)), 0, 0) + transform * vec4(position, 0, 1);","   tc = textureCoord;","}"],z,function(e){var t=y(e);d.uniform2f(e.shader.uniforms.size,t/e.width,t/e.height),ccNetViz.gl.uniformColor(d,e.shader.uniforms.color,e.style.color)})),g.add("nodesColored",new ccNetViz.primitive(d,s,null,["attribute vec2 position;","attribute vec2 textureCoord;","attribute vec4 color;","uniform vec2 size;","uniform mat4 transform;","varying vec2 tc;","varying vec4 c;","void main(void) {","   gl_Position = vec4(size * (textureCoord - vec2(0.5, 0.5)), 0, 0) + transform * vec4(position, 0, 1);","   tc = textureCoord;","   c = color;","}"],b,function(e){var t=y(e);d.uniform2f(e.shader.uniforms.size,t/e.width,t/e.height)})),s.label&&g.add("labels",new ccNetViz.primitive(d,s,"label",["attribute vec2 position;","attribute vec2 relative;","attribute vec2 textureCoord;","uniform float offset;","uniform vec2 scale;","uniform mat4 transform;","varying vec2 tc;","void main(void) {","   gl_Position = vec4(scale * (relative + vec2(0, (2.0 * step(position.y, 0.5) - 1.0) * offset)), 0, 0) + transform * vec4(position, 0, 1);","   tc = textureCoord;","}"],z,function(e){return y(e)?(d.uniform1f(e.shader.uniforms.offset,.5*e.nodeSize),d.uniform2f(e.shader.uniforms.scale,1/e.width,1/e.height),void ccNetViz.gl.uniformColor(d,e.shader.uniforms.color,e.style.color)):!0})),d.clearColor(a.r,a.g,a.b,a.a),d.blendEquation(d.FUNC_ADD),d.blendFuncSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE),d.enable(d.BLEND),t.onLoad){var V=t.styles;for(var w in V){var u=V[w];u.texture&&h.get(d,u.texture),u.arrow&&u.arrow.texture&&h.get(d,u.arrow.texture)}}e.addEventListener("mousedown",r.bind(this)),e.addEventListener("wheel",i.bind(this))},ccNetViz.utils=function(){},ccNetViz.utils.debounce=function(e,t,i){var r,n,o,c,a,s=function(){var u=Date.now-c;t>u&&u>0?r=setTimeout(s,t-u):(r=null,i||(a=e.apply(o,n),r||(o=n=null)))};return function(){o=this,n=arguments,c=Date.now;var u=i&&!r;return r||(r=setTimeout(s,t)),u&&(a=e.apply(o,n),o=n=null),a}},ccNetViz.color=function(e){if(this.a=1,arguments.length>=3)this.r=arguments[0],this.g=arguments[1],this.b=arguments[2],arguments.length>3&&(this.a=arguments[3]);else if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(e)){e=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(e);var t=function(e){return parseInt(e,10)/255};this.r=t(e[1]),this.g=t(e[2]),this.b=t(e[3])}else if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(e)){e=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(e);var t=function(e){return parseInt(e,10)/100};this.r=t(e[1]),this.g=t(e[2]),this.b=t(e[3])}else/^\#([0-9a-f]{6})$/i.test(e)?(e=parseInt(e.substring(1),16),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255):this.r=this.g=this.b=0},ccNetViz.gl=function(){},ccNetViz.gl.initExtensions=function(e){for(var t=e.getSupportedExtensions(),i={},r=1;r<arguments.length;r++){var n=arguments[r];(i[n]=t.indexOf(n)>=0)&&e.getExtension(n)}return i},ccNetViz.gl.createShader=function(e,t,i){var r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)?r:(console.log(e.getShaderInfoLog(r)),null)},ccNetViz.gl.createTexture=function(e,t,i){function r(){o.onload=null,e.bindTexture(e.TEXTURE_2D,n),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.bindTexture(e.TEXTURE_2D,null),i&&i()}var n=e.createTexture(),o=new Image;return o.onload=r,o.src=t,o.naturalWidth&&o.naturalHeight&&r(),n},ccNetViz.gl.uniformColor=function(e,t,i){e.uniform4f(t,i.r,i.g,i.b,i.a)},ccNetViz.gl.ortho=function(e,t,i,r,n,o){var c=1/(e-t),a=1/(i-r),s=1/(n-o),u=new Float32Array(16);return u[0]=-2*c,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*a,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*s,u[11]=0,u[12]=(e+t)*c,u[13]=(r+i)*a,u[14]=(o+n)*s,u[15]=1,u},ccNetViz.shader=function(e,t,i){var r=e.createProgram();e.attachShader(r,ccNetViz.gl.createShader(e,e.VERTEX_SHADER,t)),e.attachShader(r,ccNetViz.gl.createShader(e,e.FRAGMENT_SHADER,i)),e.linkProgram(r),this.uniforms={};for(var n=e.getProgramParameter(r,e.ACTIVE_UNIFORMS),o=0;n>o;o++){var c=e.getActiveUniform(r,o).name;this.uniforms[c]=e.getUniformLocation(r,c)}this.attributes={},n=e.getProgramParameter(r,e.ACTIVE_ATTRIBUTES);for(var o=0;n>o;o++){var c=e.getActiveAttrib(r,o).name;this.attributes[c]={index:o,size:ccNetViz.shader.attribute[c]||2}}this.bind=function(){e.useProgram(r);for(var t=0;n>t;t++)e.enableVertexAttribArray(t)},this.unbind=function(){for(var t=0;n>t;t++)e.disableVertexAttribArray(t)}},ccNetViz.shader.attribute={color:4},ccNetViz.primitive=function(e,t,i,r,n,o){var c=new ccNetViz.shader(e,r.join("\n"),n.join("\n")),a=[],s=[];this.set=function(e,r,n,o,u){function f(){s.push(this)}for(var v={},l=0;l<o.length;l++){var d=o[l],m=v[d.style]=v[d.style]||[];m.push(d)}var h,x,g=0,p=0,d={},y=function(e,t){h=x=0;var i=Math.floor(ccNetViz.primitive.maxBufferSize/e.numVertices),r=Math.min(i,t-(p-g)*i),n=r*e.numIndices;if(!d.indices||d.indices.length!==n){d.indices=new Uint16Array(n),r*=e.numVertices;for(var o in c.attributes)d[o]=new Float32Array(c.attributes[o].size*r)}},z=function(t){var i=a[p];if(!i){a[p]=i={};for(var r in d)i[r]=e.createBuffer()}for(var r in c.attributes)e.bindBuffer(e.ARRAY_BUFFER,i[r]),e.bufferData(e.ARRAY_BUFFER,d[r],e.STATIC_DRAW);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.indices),e.bufferData(e.ELEMENT_ARRAY_BUFFER,d.indices,e.STATIC_DRAW),i.numIndices=x,i.numVertices=h,t.buffers.push(i),p++},b=function(e){var r={},n=function(e){if(e)for(var t in e)r[t]=e[t]};return n(t),n(e),i&&(n(t[i]),e&&n(e[i])),r.color=r.color&&new ccNetViz.color(r.color),r};s=[];for(var N in v){g=p;var E={style:b(r[N]),buffers:[]},V=u(E.style);V.numVertices=V.numVertices||4,V.numIndices=V.numIndices||6;var m=v[N];y(V,m.length);for(var w=ccNetViz.primitive.maxBufferSize-V.numVertices,l=0;l<m.length;l++,h+=V.numVertices,x+=V.numIndices)h>w&&(z(E),y(V,m.length)),V.set(d,m[l],h,x);z(E);var _=f.bind(E);"string"==typeof E.style.texture?E.style.texture=n.get(e,E.style.texture,_):_()}}.bind(this);var u;this.update=function(e,t,i,r){var n=0,o=c.attributes[t].size;s.forEach(function(c){var a=r(c.style);a.numVertices=a.numVertices||4,c.buffers.forEach(function(r){(!u||u.length!==o*r.numVertices)&&(u=new Float32Array(o*r.numVertices));for(var c=0;c<r.numVertices;c+=a.numVertices)a.set(u,i[n++],c);e.bindBuffer(e.ARRAY_BUFFER,r[t]),e.bufferData(e.ARRAY_BUFFER,u,e.DYNAMIC_DRAW)})})},this.draw=function(t){t.shader=c,c.bind(),e.uniformMatrix4fv(c.uniforms.transform,!1,t.transform),s.forEach(function(i){i.style.texture&&(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i.style.texture),e.uniform1i(c.uniforms.texture,0)),t.style=i.style,o(t)||i.buffers.forEach(function(t){e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indices);for(var i in c.attributes){var r=c.attributes[i];e.bindBuffer(e.ARRAY_BUFFER,t[i]),e.vertexAttribPointer(r.index,r.size,e.FLOAT,!1,0,0)}e.drawElements(e.TRIANGLES,t.numIndices,e.UNSIGNED_SHORT,0)})}),c.unbind()}},ccNetViz.primitive.vertices=function(e,t){for(var i=2,r=2*t,n=arguments.length;n>i;i++,r++)e[r]=arguments[i]},ccNetViz.primitive.colors=function(e,t){for(var i=2,r=4*t,n=arguments.length;n>i;i++){var o=arguments[i];e[r++]=o.r,e[r++]=o.g,e[r++]=o.b,e[r++]=o.a}},ccNetViz.primitive.indices=function(e,t,i){for(var r=3,n=i,o=arguments.length;o>r;r++,n++)e[n]=t+arguments[r]},ccNetViz.primitive.quad=function(e,t,i){ccNetViz.primitive.indices(e,t,i,0,1,2,2,3,0)},ccNetViz.primitive.maxBufferSize=65536,ccNetViz.textures=function(e){var t=ccNetViz.utils.debounce(e,5),i={},r={},n=0;this.get=function(e,o,c){var a=r[o],s=i[o];return a?a.push(c):s?c&&c():(a=r[o]=[c],n++,i[o]=s=ccNetViz.gl.createTexture(e,o,function(){a.forEach(function(e){return e&&e()}),delete r[o],--n||t()})),s}},ccNetViz.texts=function(e){var t=1024,i=document.createElement("canvas");i.width=i.height=t,i.style.width=i.style.height=t+"px",i.style.display="none",document.body.appendChild(i);var r=i.getContext("2d");r.fillStyle="white",r.textAlign="left",r.textBaseline="top";var n,o,c,a,s;this.texture=e.createTexture(),this.clear=function(){n={},r.clearRect(0,0,t,t),s=c=a=0},this.setFont=function(e){n[e]=o=n[e]||{},r.font=e,c=0,a+=s,s=+/(\d+)px/.exec(e)[1]+1},this.get=function(e){var i=o[e];if(!i){var n=r.measureText(e).width;c+n>t&&(c=0,a+=s),r.fillText(e,c,a),o[e]=i={width:n,height:s,left:c/t,right:(c+n)/t,top:a/t,bottom:(a+s)/t},c+=n}return i},this.bind=function(){e.bindTexture(e.TEXTURE_2D,this.texture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i),e.bindTexture(e.TEXTURE_2D,null)}.bind(this)},ccNetViz.quadtree=function(e){function t(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function i(e,t,r,n,o,c){if(!e(t,r,n,o,c)){var a=.5*(r+o),s=.5*(n+c),u=t.nodes;u[0]&&i(e,u[0],r,n,a,s),u[1]&&i(e,u[1],a,n,o,s),u[2]&&i(e,u[2],r,s,a,c),u[3]&&i(e,u[3],a,s,o,c)}}function r(e,t,i,r,o,c,a,s){if(e.leaf){var u=e.x,f=e.y;if(null!==u)if(u===i&&f===r)n(e,t,i,r,o,c,a,s);else{var v=e.point;e.x=e.y=e.point=null,n(e,v,u,f,o,c,a,s),n(e,t,i,r,o,c,a,s)}else e.x=i,e.y=r,e.point=t}else n(e,t,i,r,o,c,a,s)}function n(e,i,n,o,c,a,s,u){var f=.5*(c+s),v=.5*(a+u),l=n>=f,d=o>=v,m=d<<1|l;e.leaf=!1,e=e.nodes[m]||(e.nodes[m]=t()),l?c=f:s=f,d?a=v:u=v,r(e,i,n,o,c,a,s,u)}function o(e,t,i,r,n,o,c){var a,s=1/0;return function u(e,f,v,l,d){if(!(f>o||v>c||r>l||n>d)){if(m=e.point){var m,h=t-e.x,x=i-e.y,g=h*h+x*x;if(s>g){var p=Math.sqrt(s=g);r=t-p,n=i-p,o=t+p,c=i+p,a=m}}for(var y=e.nodes,z=.5*(f+l),b=.5*(v+d),N=t>=z,E=i>=b,V=E<<1|N,w=V+4;w>V;++V)if(e=y[3&V])switch(3&V){case 0:u(e,f,v,z,b);break;case 1:u(e,z,v,l,b);break;case 2:u(e,f,b,z,d);break;case 3:u(e,z,b,l,d)}}}(e,r,n,o,c),a}var c,a,s,u,f,v,l,d,m;for(d=m=-(v=l=1/0),a=[],s=[],f=e.length,u=0;f>u;++u)c=e[u],c.x<v&&(v=c.x),c.y<l&&(l=c.y),c.x>d&&(d=c.x),c.y>m&&(m=c.y),a.push(c.x),s.push(c.y);var h=d-v,x=m-l;h>x?m=l+h:d=v+x;var g=t();for(g.visit=function(e){return i(e,g,v,l,d,m)},g.find=function(e,t){return o(g,e,t,v,l,d,m)},u=0;f>u;u++)r(g,e[u],a[u],s[u],v,l,d,m);return--u,a=s=e=c=null,g},ccNetViz.layout=function(){},ccNetViz.layout.normalize=function(e){for(var t=e.length,i=-(1/0),r=-(1/0),n=1/0,o=1/0,c=0;t>c;c++){var a=e[c];i=Math.max(i,a.x),r=Math.max(r,a.y),n=Math.min(n,a.x),o=Math.min(o,a.y)}for(var s=n!==i?1/(i-n):(n-=.5,1),u=o!==r?1/(r-o):(o-=.5,1),c=0;t>c;c++){var a=e[c];a.x=s*(a.x-n),a.y=u*(a.y-o)}},ccNetViz.layout.random=function(e){this.apply=function(){for(var t=0,i=e.length;i>t;t++){var r=e[t];r.x=Math.random(),r.y=Math.random()}}},ccNetViz.layout.force=function(e,t){function i(e,t,r){var n=0,o=0;if(e.charge=0,!e.leaf)for(var c,a=e.nodes,s=a.length,u=0;s>u;u++)c=a[u],null!=c&&(i(c,t,r),e.charge+=c.charge,n+=c.charge*c.cx,o+=c.charge*c.cy);if(e.point){e.leaf||(e.point.x+=Math.random()-.5,e.point.y+=Math.random()-.5);var f=t*r[e.point.index];e.charge+=e.pointCharge=f,n+=f*e.point.x,o+=f*e.point.y}e.cx=n/e.charge,e.cy=o/e.charge}function r(e){return function(t,i,r,n){if(t.point!==e){var o=t.cx-e.x,c=t.cy-e.y,a=n-i,s=o*o+c*c;if(s>a*a/d){if(v>s){var u=t.charge/s;e.px-=o*u,e.py-=c*u}return!0}if(t.point&&s&&v>s){var u=t.pointCharge/s;e.px-=o*u,e.py-=c*u}}return!t.charge}}function n(){if((o*=.99)<.05)return o=0,!0;for(var n,s,u,v,d,g,p,y,z=e.length,b=t.length,N=0;b>N;N++)s=t[N],u=s.source,v=s.target,p=v.x-u.x,y=v.y-u.y,(d=p*p+y*y)&&(d=o*h[N]*((d=Math.sqrt(d))-m[N])/d,p*=d,y*=d,v.x-=p*(g=u.weight/(v.weight+u.weight)),v.y-=y*g,u.x+=p*(g=1-g),u.y+=y*g);if(g=o*l){p=c[0]/2,y=c[1]/2;for(var N=0;z>N;N++)s=e[N],s.x+=(p-s.x)*g,s.y+=(y-s.y)*g}if(f){i(n=ccNetViz.quadtree(e),o,x);for(var N=0;z>N;N++){var s=e[N];!s.fixed&&n.visit(r(s))}}for(var N=0;z>N;N++)s=e[N],s.fixed?(s.x=s.px,s.y=s.py):(s.x-=(s.px-(s.px=s.x))*a,s.y-=(s.py-(s.py=s.y))*a)}var o,c=[1,1],a=.9,s=15,u=1,f=-30,v=1/0,l=.4,d=.64,m=[],h=[],x=[];this.apply=function(){for(var i=e.length,r=Math.sqrt(i),c=.3/r,a=0;i>a;a++){var v=e[a];v.weight=0,v.x=void 0!==v.x?v.x:c+a%r/r,v.y=void 0!==v.y?v.y:c+Math.floor(a/r)/r,v.px=v.x,v.py=v.y,x[a]=f}for(var a=0;a<t.length;a++){var v=t[a];v.source.weight++,v.target.weight++,m[a]=s,h[a]=u}for(o=.1;!n(););return!0}};