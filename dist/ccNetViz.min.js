ccNetViz=function(a,b){b=b||{};b.styles=b.styles||{};var g=b.styles.background=b.styles.background||{},g=new ccNetViz.color(g.color||"rgb(255, 255, 255)"),m=b.styles.node=b.styles.node||{};m.minSize=null!=m.minSize?m.minSize:6;m.maxSize=m.maxSize||16;m.color=m.color||"rgb(255, 255, 255)";if(m.label){var h=m.label;h.color=h.color||"rgb(120, 120, 120)";h.font=h.font||"11px Arial, Helvetica, sans-serif"}var q=b.styles.edge=b.styles.edge||{};q.width=q.width||1;q.color=q.color||"rgb(204, 204, 204)";q.arrow&&
(h=q.arrow,h.minSize=null!=h.minSize?h.minSize:6,h.maxSize=h.maxSize||12,h.aspect=1);var n=.5*m.maxSize;this.set=function(e,a,c){this.nodes=e=e||[];this.edges=a=a||[];var f=[],k=[],g=[],w=function(e,a){var c=a.x-e.x,f=a.y-e.y,k=1/Math.sqrt(c*c+f*f);return{x:k*c,y:k*f}};(function(){for(var c=0;c<e.length;c++)e[c].index=c;if(r.OES_standard_derivatives){for(var b={},c=0;c<a.length;c++){var C=a[c];(b[C.source.index]||(b[C.source.index]={}))[C.target.index]=!0}for(c=0;c<a.length;c++){var u,C=a[c];u=C.source.index===
C.target.index?g:(u=b[C.target.index])&&u[C.source.index]?k:f;u.push(C)}}else for(c=0;c<a.length;c++)C=a[c],C.source.index!==C.target.index&&f.push(C)})();c&&(new ccNetViz.layout[c](e,a)).apply()&&ccNetViz.layout.normalize(e);v.nodes.set(l,b.styles,u,e.length&&!e[0].color?e:[],function(e){return{set:function(e,a,c,f){var b=a.x;a=a.y;ccNetViz.primitive.vertices(e.position,c,b,a,b,a,b,a,b,a);ccNetViz.primitive.vertices(e.textureCoord,c,0,0,1,0,1,1,0,1);ccNetViz.primitive.quad(e.indices,c,f)}}});v.nodesColored.set(l,
b.styles,u,e.length&&e[0].color?e:[],function(e){return{set:function(e,a,c,f){var b=a.x,k=a.y;a=a.color;ccNetViz.primitive.vertices(e.position,c,b,k,b,k,b,k,b,k);ccNetViz.primitive.vertices(e.textureCoord,c,0,0,1,0,1,1,0,1);ccNetViz.primitive.colors(e.color,c,a,a,a,a);ccNetViz.primitive.quad(e.indices,c,f)}}});m.label&&(t.clear(),v.labels.set(l,b.styles,u,e,function(e){t.setFont(e.font);e.texture=t.texture;return{set:function(e,a,c,f){var b=a.x,k=a.y;ccNetViz.primitive.vertices(e.position,c,b,k,b,
k,b,k,b,k);a=t.get(a.label);b=.5>=b?0:-a.width;k=.5>=k?0:-a.height;ccNetViz.primitive.vertices(e.relative,c,b,k,a.width+b,k,a.width+b,a.height+k,b,a.height+k);ccNetViz.primitive.vertices(e.textureCoord,c,a.left,a.bottom,a.right,a.bottom,a.right,a.top,a.left,a.top);ccNetViz.primitive.quad(e.indices,c,f)}}}),t.bind());v.lines.set(l,b.styles,u,f,function(e){return{set:function(e,a,c,f){var b=a.source;a=a.target;var k=w(b,a);ccNetViz.primitive.vertices(e.position,c,b.x,b.y,b.x,b.y,a.x,a.y,a.x,a.y);ccNetViz.primitive.vertices(e.normal,
c,-k.y,k.x,k.y,-k.x,k.y,-k.x,-k.y,k.x);ccNetViz.primitive.quad(e.indices,c,f)}}});r.OES_standard_derivatives&&(v.curves.set(l,b.styles,u,k,function(e){return{numVertices:3,numIndices:3,set:function(e,a,c,f){var b=a.source;a=a.target;var k=w(b,a);ccNetViz.primitive.vertices(e.position,c,b.x,b.y,.5*(a.x+b.x),.5*(a.y+b.y),a.x,a.y);ccNetViz.primitive.vertices(e.normal,c,0,0,k.y,-k.x,0,0);ccNetViz.primitive.vertices(e.curve,c,1,1,.5,0,0,0);ccNetViz.primitive.indices(e.indices,c,f,0,1,2)}}}),v.circles.set(l,
b.styles,u,g,function(e){return{set:function(e,a,c,b){a=a.source;var f=.5>a.y?1:-1;ccNetViz.primitive.vertices(e.position,c,a.x,a.y,a.x,a.y,a.x,a.y,a.x,a.y);ccNetViz.primitive.vertices(e.normal,c,0,0,1,f,0,1.25*f,-1,f);ccNetViz.primitive.vertices(e.curve,c,1,1,.5,0,0,0,.5,0);ccNetViz.primitive.quad(e.indices,c,b)}}}));if(q.arrow){var h=function(e,a,c,b,f,k){var F=a.target.x;a=a.target.y;ccNetViz.primitive.vertices(e.position,c,F,a,F,a,F,a,F,a);ccNetViz.primitive.vertices(e.direction,c,f,k,f,k,f,k,
f,k);ccNetViz.primitive.vertices(e.textureCoord,c,0,0,1,0,1,1,0,1);ccNetViz.primitive.quad(e.indices,c,b)};v.lineArrows.set(l,b.styles,u,f,function(e){return{set:function(e,a,c,f){var b=w(a.source,a.target);h(e,a,c,f,b.x,b.y)}}});if(r.OES_standard_derivatives){v.curveArrows.set(l,b.styles,u,k,function(e){return{set:function(e,a,c,f){return h(e,a,c,f,.5*(a.target.x-a.source.x),.5*(a.target.y-a.source.y))}}});var p=Math.cos(.9),n=Math.sin(.9);v.circleArrows.set(l,b.styles,u,g,function(e){return{set:function(e,
a,c,f){return h(e,a,c,f,.5>a.target.x?p:-p,.5>a.target.y?-n:n)}}})}}};this.update=function(e,a,c){v[e].update(l,a,c,function(e){return{set:function(e,a,c){return ccNetViz.primitive.colors(e,c,a,a,a,a)}}})};this.draw=function(){var e=a.width,f=a.height,b=e/f,u=1===p.size?n:0,g=u/e,u=u/f,w={transform:ccNetViz.gl.ortho(p.x-g,p.x+p.size+g,p.y-u,p.y+p.size+u,-1,1),width:.5*e,height:.5*f,aspect2:b*b,count:this.nodes.length};w.curveExc=k(w,this.edges.length,.5);w.style=m;w.nodeSize=c(w);l.viewport(0,0,e,
f);l.clear(l.COLOR_BUFFER_BIT);v.elements.forEach(function(e){return e.draw(w)})}.bind(this);this.resize=function(){a.width=a.offsetWidth;a.height=a.offsetHeight};this.resetView=function(){p.size=1;p.x=p.y=0};this.image=function(){return a.toDataURL()};this.resize();this.nodes=[];this.edges=[];var p={};this.resetView();var l=function(){var e={depth:!1,antialias:!1};return a.getContext("webgl",e)||a.getContext("experimental-webgl",e)}(),r=ccNetViz.gl.initExtensions(l,"OES_standard_derivatives"),u=
new ccNetViz.textures(b.onLoad||this.draw),t=new ccNetViz.texts(l),v=function(){return{elements:[],add:function(e,a){v[e]=a;v.elements.push(a)}}}.call(this),k=function(e,a,c){a=c*Math.sqrt(e.width*e.height/a)/p.size;if(e=e.style)a=e.maxSize?Math.min(e.maxSize,a):a,a=a<e.hideSize?0:e.minSize?Math.max(e.minSize,a):a;return a},c=function(a){return k(a,this.nodes.length,.4)}.bind(this),h=["precision mediump float;","uniform vec4 color;","uniform sampler2D texture;","varying vec2 tc;","void main(void) {",
"   gl_FragColor = color * texture2D(texture, vec2(tc.s, tc.t));","}"],w=["#extension GL_OES_standard_derivatives : enable","#ifdef GL_ES","precision highp float;","#endif","uniform float width;","uniform vec4 color;","varying vec2 c;","void main(void) {","   vec2 px = dFdx(c);","   vec2 py = dFdy(c);","   float fx = 2.0 * c.x * px.x - px.y;","   float fy = 2.0 * c.y * py.x - py.y;","   float sd = (c.x * c.x - c.y) / sqrt(fx * fx + fy * fy);","   float alpha = 1.0 - abs(sd) / width;","   if (alpha < 0.0) discard;",
"   gl_FragColor = vec4(color.r, color.g, color.b, min(alpha, 1.0));","}"];v.add("lines",new ccNetViz.primitive(l,q,null,["attribute vec2 position;","attribute vec2 normal;","uniform vec2 width;","uniform mat4 transform;","varying vec2 n;","void main(void) {","   gl_Position = vec4(width * normal, 0, 0) + transform * vec4(position, 0, 1);","   n = normal;","}"],["precision mediump float;","uniform vec4 color;","varying vec2 n;","void main(void) {","   gl_FragColor = vec4(color.r, color.g, color.b, color.a - length(n));",
"}"],function(a){l.uniform2f(a.shader.uniforms.width,a.style.width/a.width,a.style.width/a.height);ccNetViz.gl.uniformColor(l,a.shader.uniforms.color,a.style.color)}));r.OES_standard_derivatives&&(v.add("curves",new ccNetViz.primitive(l,q,null,["attribute vec2 position;","attribute vec2 normal;","attribute vec2 curve;","uniform float exc;","uniform vec2 screen;","uniform float aspect2;","uniform mat4 transform;","varying vec2 c;","void main(void) {","   vec2 n = vec2(normal.x, aspect2 * normal.y);",
"   float length = length(screen * n);","   n = length == 0.0 ? vec2(0, 0) : n / length;","   gl_Position = vec4(exc * n, 0, 0) + transform * vec4(position, 0, 1);","   c = curve;","}"],w,function(a){l.uniform1f(a.shader.uniforms.width,a.style.width);l.uniform1f(a.shader.uniforms.exc,a.curveExc);l.uniform2f(a.shader.uniforms.screen,a.width,a.height);l.uniform1f(a.shader.uniforms.aspect2,a.aspect2);ccNetViz.gl.uniformColor(l,a.shader.uniforms.color,a.style.color)})),v.add("circles",new ccNetViz.primitive(l,
q,null,["attribute vec2 position;","attribute vec2 normal;","attribute vec2 curve;","uniform vec2 size;","uniform mat4 transform;","varying vec2 c;","void main(void) {","   gl_Position = vec4(size * normal, 0, 0) + transform * vec4(position, 0, 1);","   c = curve;","}"],w,function(a){l.uniform1f(a.shader.uniforms.width,a.style.width);var c=2.5*a.nodeSize;l.uniform2f(a.shader.uniforms.size,c/a.width,c/a.height);ccNetViz.gl.uniformColor(l,a.shader.uniforms.color,a.style.color)})));q.arrow&&(w=function(a){var c=
k(a,this.edges.length,.2);if(!c)return!0;l.uniform1f(a.shader.uniforms.offset,.5*a.nodeSize);l.uniform2f(a.shader.uniforms.size,c,a.style.aspect*c);a.shader.uniforms.exc&&l.uniform1f(a.shader.uniforms.exc,.5*p.size*a.curveExc);l.uniform2f(a.shader.uniforms.screen,a.width,a.height);a.shader.uniforms.aspect2&&l.uniform1f(a.shader.uniforms.aspect2,a.aspect2);ccNetViz.gl.uniformColor(l,a.shader.uniforms.color,a.style.color)}.bind(this),v.add("lineArrows",new ccNetViz.primitive(l,q,"arrow",["attribute vec2 position;",
"attribute vec2 direction;","attribute vec2 textureCoord;","uniform float offset;","uniform vec2 size;","uniform vec2 screen;","uniform float aspect2;","uniform mat4 transform;","varying vec2 tc;","void main(void) {","   vec2 u = direction / length(screen * direction);","   vec2 v = vec2(u.y, -aspect2 * u.x);","   v = v / length(screen * v);","   gl_Position = vec4(size.x * (0.5 - textureCoord.x) * v - size.y * textureCoord.y * u - offset * u, 0, 0) + transform * vec4(position, 0, 1);","   tc = textureCoord;",
"}"],h,w)),r.OES_standard_derivatives&&(v.add("curveArrows",new ccNetViz.primitive(l,q,"arrow",["attribute vec2 position;","attribute vec2 direction;","attribute vec2 textureCoord;","uniform float offset;","uniform vec2 size;","uniform float exc;","uniform vec2 screen;","uniform float aspect2;","uniform mat4 transform;","varying vec2 tc;","void main(void) {","   vec2 u = normalize(vec2(direction.y, -aspect2 * direction.x));","   u = normalize(direction - exc * u / length(screen * u));","   u = u / length(screen * u);",
"   vec2 v = vec2(u.y, -aspect2 * u.x);","   v = v / length(screen * v);","   gl_Position = vec4(size.x * (0.5 - textureCoord.x) * v - size.y * textureCoord.y * u - offset * u, 0, 0) + transform * vec4(position, 0, 1);","   tc = textureCoord;","}"],h,w)),v.add("circleArrows",new ccNetViz.primitive(l,q,"arrow",["attribute vec2 position;","attribute vec2 direction;","attribute vec2 textureCoord;","uniform float offset;","uniform vec2 size;","uniform vec2 screen;","uniform mat4 transform;","varying vec2 tc;",
"void main(void) {","   vec2 u = direction;","   vec2 v = vec2(direction.y, -direction.x);","   gl_Position = vec4((size.x * (0.5 - textureCoord.x) * v - size.y * textureCoord.y * u - offset * u) / screen, 0, 0) + transform * vec4(position, 0, 1);","   tc = textureCoord;","}"],h,w))));v.add("nodes",new ccNetViz.primitive(l,m,null,["attribute vec2 position;","attribute vec2 textureCoord;","uniform vec2 size;","uniform mat4 transform;","varying vec2 tc;","void main(void) {","   gl_Position = vec4(size * (textureCoord - vec2(0.5, 0.5)), 0, 0) + transform * vec4(position, 0, 1);",
"   tc = textureCoord;","}"],h,function(a){var f=c(a);l.uniform2f(a.shader.uniforms.size,f/a.width,f/a.height);ccNetViz.gl.uniformColor(l,a.shader.uniforms.color,a.style.color)}));v.add("nodesColored",new ccNetViz.primitive(l,m,null,["attribute vec2 position;","attribute vec2 textureCoord;","attribute vec4 color;","uniform vec2 size;","uniform mat4 transform;","varying vec2 tc;","varying vec4 c;","void main(void) {","   gl_Position = vec4(size * (textureCoord - vec2(0.5, 0.5)), 0, 0) + transform * vec4(position, 0, 1);",
"   tc = textureCoord;","   c = color;","}"],["precision mediump float;","uniform sampler2D texture;","varying vec2 tc;","varying vec4 c;","void main(void) {","   gl_FragColor = c * texture2D(texture, vec2(tc.s, tc.t));","}"],function(a){var f=c(a);l.uniform2f(a.shader.uniforms.size,f/a.width,f/a.height)}));m.label&&v.add("labels",new ccNetViz.primitive(l,m,"label",["attribute vec2 position;","attribute vec2 relative;","attribute vec2 textureCoord;","uniform float offset;","uniform vec2 scale;","uniform mat4 transform;",
"varying vec2 tc;","void main(void) {","   gl_Position = vec4(scale * (relative + vec2(0, (2.0 * step(position.y, 0.5) - 1.0) * offset)), 0, 0) + transform * vec4(position, 0, 1);","   tc = textureCoord;","}"],h,function(a){if(!c(a))return!0;l.uniform1f(a.shader.uniforms.offset,.5*a.nodeSize);l.uniform2f(a.shader.uniforms.scale,1/a.width,1/a.height);ccNetViz.gl.uniformColor(l,a.shader.uniforms.color,a.style.color)}));l.clearColor(g.r,g.g,g.b,g.a);l.blendEquation(l.FUNC_ADD);l.blendFuncSeparate(l.SRC_ALPHA,
l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE);l.enable(l.BLEND);if(b.onLoad){var g=b.styles,f;for(f in g)h=g[f],h.texture&&u.get(l,h.texture),h.arrow&&h.arrow.texture&&u.get(l,h.arrow.texture)}a.addEventListener("mousedown",function(e){var c=a.width/p.size,f=a.height/p.size,b=p.x+e.clientX/c,k=e.clientY/f-p.y,u=function(a){p.x=Math.max(0,Math.min(1-p.size,b-a.clientX/c));p.y=Math.max(0,Math.min(1-p.size,a.clientY/f-k));this.draw();a.preventDefault()}.bind(this),w=function(){window.removeEventListener("mouseup",
w);window.removeEventListener("mousemove",u)};window.addEventListener("mouseup",w);window.addEventListener("mousemove",u)}.bind(this));a.addEventListener("wheel",function(c){var f=a.getBoundingClientRect(),b=Math.min(1,p.size*(1+.001*(c.deltaMode?33:1)*c.deltaY)),k=b-p.size;p.size=b;p.x=Math.max(0,Math.min(1-b,p.x-k*(c.clientX-f.left)/a.width));p.y=Math.max(0,Math.min(1-b,p.y-k*(1-(c.clientY-f.top)/a.height)));this.draw();c.preventDefault()}.bind(this))};ccNetViz.utils=function(){};
ccNetViz.utils.debounce=function(a,b,g){var m,h,q,n,p,l=function(){var r=Date.now-n;r<b&&0<r?m=setTimeout(l,b-r):(m=null,g||(p=a.apply(q,h),m||(q=h=null)))};return function(){q=this;h=arguments;n=Date.now;var r=g&&!m;m||(m=setTimeout(l,b));r&&(p=a.apply(q,h),q=h=null);return p}};
ccNetViz.color=function(a){this.a=1;if(3<=arguments.length)this.r=arguments[0],this.g=arguments[1],this.b=arguments[2],3<arguments.length&&(this.a=arguments[3]);else if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(a)){a=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(a);var b=function(a){return parseInt(a,10)/255};this.r=b(a[1]);this.g=b(a[2]);this.b=b(a[3])}else/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(a)?(a=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(a),b=function(a){return parseInt(a,10)/100},this.r=b(a[1]),
this.g=b(a[2]),this.b=b(a[3])):/^\#([0-9a-f]{6})$/i.test(a)?(a=parseInt(a.substring(1),16),this.r=(a>>16&255)/255,this.g=(a>>8&255)/255,this.b=(a&255)/255):this.r=this.g=this.b=0};ccNetViz.gl=function(){};ccNetViz.gl.initExtensions=function(a){for(var b=a.getSupportedExtensions(),g={},m=1;m<arguments.length;m++){var h=arguments[m];(g[h]=0<=b.indexOf(h))&&a.getExtension(h)}return g};
ccNetViz.gl.createShader=function(a,b,g){b=a.createShader(b);a.shaderSource(b,g);a.compileShader(b);return a.getShaderParameter(b,a.COMPILE_STATUS)?b:(console.log(a.getShaderInfoLog(b)),null)};
ccNetViz.gl.createTexture=function(a,b,g){function m(){q.onload=null;a.bindTexture(a.TEXTURE_2D,h);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,q);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.bindTexture(a.TEXTURE_2D,null);g&&g()}var h=a.createTexture(),q=new Image;q.onload=m;q.src=b;q.naturalWidth&&q.naturalHeight&&m();return h};
ccNetViz.gl.uniformColor=function(a,b,g){a.uniform4f(b,g.r,g.g,g.b,g.a)};ccNetViz.gl.ortho=function(a,b,g,m,h,q){var n=1/(a-b),p=1/(g-m),l=1/(h-q),r=new Float32Array(16);r[0]=-2*n;r[1]=0;r[2]=0;r[3]=0;r[4]=0;r[5]=-2*p;r[6]=0;r[7]=0;r[8]=0;r[9]=0;r[10]=2*l;r[11]=0;r[12]=(a+b)*n;r[13]=(m+g)*p;r[14]=(q+h)*l;r[15]=1;return r};
ccNetViz.shader=function(a,b,g){var m=a.createProgram();a.attachShader(m,ccNetViz.gl.createShader(a,a.VERTEX_SHADER,b));a.attachShader(m,ccNetViz.gl.createShader(a,a.FRAGMENT_SHADER,g));a.linkProgram(m);this.uniforms={};var h=a.getProgramParameter(m,a.ACTIVE_UNIFORMS);for(b=0;b<h;b++)g=a.getActiveUniform(m,b).name,this.uniforms[g]=a.getUniformLocation(m,g);this.attributes={};h=a.getProgramParameter(m,a.ACTIVE_ATTRIBUTES);for(b=0;b<h;b++)g=a.getActiveAttrib(m,b).name,this.attributes[g]={index:b,size:ccNetViz.shader.attribute[g]||
2};this.bind=function(){a.useProgram(m);for(var b=0;b<h;b++)a.enableVertexAttribArray(b)};this.unbind=function(){for(var b=0;b<h;b++)a.disableVertexAttribArray(b)}};ccNetViz.shader.attribute={color:4};
ccNetViz.primitive=function(a,b,g,m,h,q){var n=new ccNetViz.shader(a,m.join("\n"),h.join("\n")),p=[],l=[];this.set=function(a,t,m,k,c){for(var w={},f=0;f<k.length;f++){var e=k[f],h=w[e.style]=w[e.style]||[];h.push(e)}var q,r,G=0,D=0,e={};k=function(a,c){q=r=0;var f=Math.floor(ccNetViz.primitive.maxBufferSize/a.numVertices),f=Math.min(f,c-(D-G)*f),b=f*a.numIndices;if(!e.indices||e.indices.length!==b){e.indices=new Uint16Array(b);var f=f*a.numVertices,k;for(k in n.attributes)e[k]=new Float32Array(n.attributes[k].size*
f)}};var A=function(c){var f=p[D];if(!f){p[D]=f={};for(var b in e)f[b]=a.createBuffer()}for(b in n.attributes)a.bindBuffer(a.ARRAY_BUFFER,f[b]),a.bufferData(a.ARRAY_BUFFER,e[b],a.STATIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,f.indices);a.bufferData(a.ELEMENT_ARRAY_BUFFER,e.indices,a.STATIC_DRAW);f.numIndices=r;f.numVertices=q;c.buffers.push(f);D++},E=function(a){var c={},e=function(a){if(a)for(var e in a)c[e]=a[e]};e(b);e(a);g&&(e(b[g]),a&&e(a[g]));c.color=c.color&&new ccNetViz.color(c.color);
return c};l=[];for(var B in w){var G=D,x={style:E(t[B]),buffers:[]},y=c(x.style);y.numVertices=y.numVertices||4;y.numIndices=y.numIndices||6;h=w[B];k(y,h.length);for(var z=ccNetViz.primitive.maxBufferSize-y.numVertices,f=0;f<h.length;f++,q+=y.numVertices,r+=y.numIndices)q>z&&(A(x),k(y,h.length)),y.set(e,h[f],q,r);A(x);f=function(){l.push(this)}.bind(x);"string"===typeof x.style.texture?x.style.texture=m.get(a,x.style.texture,f):f()}}.bind(this);var r;this.update=function(a,b,g,k){var c=0,w=n.attributes[b].size;
l.forEach(function(f){var e=k(f.style);e.numVertices=e.numVertices||4;f.buffers.forEach(function(f){r&&r.length===w*f.numVertices||(r=new Float32Array(w*f.numVertices));for(var k=0;k<f.numVertices;k+=e.numVertices)e.set(r,g[c++],k);a.bindBuffer(a.ARRAY_BUFFER,f[b]);a.bufferData(a.ARRAY_BUFFER,r,a.DYNAMIC_DRAW)})})};this.draw=function(b){b.shader=n;n.bind();a.uniformMatrix4fv(n.uniforms.transform,!1,b.transform);l.forEach(function(g){g.style.texture&&(a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,
g.style.texture),a.uniform1i(n.uniforms.texture,0));b.style=g.style;q(b)||g.buffers.forEach(function(b){a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,b.indices);for(var k in n.attributes){var c=n.attributes[k];a.bindBuffer(a.ARRAY_BUFFER,b[k]);a.vertexAttribPointer(c.index,c.size,a.FLOAT,!1,0,0)}a.drawElements(a.TRIANGLES,b.numIndices,a.UNSIGNED_SHORT,0)})});n.unbind()}};ccNetViz.primitive.vertices=function(a,b){for(var g=2,m=2*b,h=arguments.length;g<h;g++,m++)a[m]=arguments[g]};
ccNetViz.primitive.colors=function(a,b){for(var g=2,m=4*b,h=arguments.length;g<h;g++){var q=arguments[g];a[m++]=q.r;a[m++]=q.g;a[m++]=q.b;a[m++]=q.a}};ccNetViz.primitive.indices=function(a,b,g){for(var m=3,h=g,q=arguments.length;m<q;m++,h++)a[h]=b+arguments[m]};ccNetViz.primitive.quad=function(a,b,g){ccNetViz.primitive.indices(a,b,g,0,1,2,2,3,0)};ccNetViz.primitive.maxBufferSize=65536;
ccNetViz.textures=function(a){var b=ccNetViz.utils.debounce(a,5),g={},m={},h=0;this.get=function(a,n,p){var l=m[n],r=g[n];l?l.push(p):r?p&&p():(l=m[n]=[p],h++,g[n]=r=ccNetViz.gl.createTexture(a,n,function(){l.forEach(function(a){return a&&a()});delete m[n];--h||b()}));return r}};
ccNetViz.texts=function(a){var b=document.createElement("canvas");b.width=b.height=1024;b.style.width=b.style.height="1024px";b.style.display="none";document.body.appendChild(b);var g=b.getContext("2d");g.fillStyle="white";g.textAlign="left";g.textBaseline="top";var m,h,q,n,p;this.texture=a.createTexture();this.clear=function(){m={};g.clearRect(0,0,1024,1024);p=q=n=0};this.setFont=function(a){m[a]=h=m[a]||{};g.font=a;q=0;n+=p;p=+/(\d+)px/.exec(a)[1]+1};this.get=function(a){var b=h[a];if(!b){var u=
g.measureText(a).width;1024<q+u&&(q=0,n+=p);g.fillText(a,q,n);h[a]=b={width:u,height:p,left:q/1024,right:(q+u)/1024,top:n/1024,bottom:(n+p)/1024};q+=u}return b};this.bind=function(){a.bindTexture(a.TEXTURE_2D,this.texture);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,b);a.bindTexture(a.TEXTURE_2D,null)}.bind(this)};
ccNetViz.quadtree=function(a){function b(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function g(a,c,b,k,w,h){if(!a(c,b,k,w,h)){var u=.5*(b+w),m=.5*(k+h);c=c.nodes;c[0]&&g(a,c[0],b,k,u,m);c[1]&&g(a,c[1],u,k,w,m);c[2]&&g(a,c[2],b,m,u,h);c[3]&&g(a,c[3],u,m,w,h)}}function m(a,c,b,k,w,g,u,m){if(a.leaf){var l=a.x,t=a.y;if(null!==l){if(l!==b||t!==k){var p=a.point;a.x=a.y=a.point=null;h(a,p,l,t,w,g,u,m)}h(a,c,b,k,w,g,u,m)}else a.x=b,a.y=k,a.point=c}else h(a,c,b,k,w,g,u,m)}function h(a,c,k,w,g,u,h,
l){var t=.5*(g+h),p=.5*(u+l),v=k>=t,n=w>=p,q=n<<1|v;a.leaf=!1;a=a.nodes[q]||(a.nodes[q]=b());v?g=t:h=t;n?u=p:l=p;m(a,c,k,w,g,u,h,l)}function q(a,c,b,k,w,g,u){var h=Infinity,m;(function x(a,f,l,t,p){if(!(f>g||l>u||t<k||p<w)){if(v=a.point){var v,n=c-a.x,q=b-a.y,n=n*n+q*q;n<h&&(n=Math.sqrt(h=n),k=c-n,w=b-n,g=c+n,u=b+n,m=v)}v=a.nodes;for(var n=.5*(f+t),q=.5*(l+p),r=(b>=q)<<1|c>=n,H=r+4;r<H;++r)if(a=v[r&3])switch(r&3){case 0:x(a,f,l,n,q);break;case 1:x(a,n,l,t,q);break;case 2:x(a,f,q,n,p);break;case 3:x(a,
n,q,t,p)}}})(a,k,w,g,u);return m}var n,p,l,r,u,t,v,k,c;k=c=-(t=v=Infinity);p=[];l=[];u=a.length;for(r=0;r<u;++r)n=a[r],n.x<t&&(t=n.x),n.y<v&&(v=n.y),n.x>k&&(k=n.x),n.y>c&&(c=n.y),p.push(n.x),l.push(n.y);n=k-t;r=c-v;n>r?c=v+n:k=t+r;var w=b();w.visit=function(a){return g(a,w,t,v,k,c)};w.find=function(a,b){return q(w,a,b,t,v,k,c)};for(r=0;r<u;r++)m(w,a[r],p[r],l[r],t,v,k,c);--r;p=l=a=n=null;return w};ccNetViz.layout=function(){};
ccNetViz.layout.normalize=function(a){for(var b=a.length,g=-Infinity,m=-Infinity,h=Infinity,q=Infinity,n=0;n<b;n++)var p=a[n],g=Math.max(g,p.x),m=Math.max(m,p.y),h=Math.min(h,p.x),q=Math.min(q,p.y);g=h!==g?1/(g-h):(h-=.5,1);m=q!==m?1/(m-q):(q-=.5,1);for(n=0;n<b;n++)p=a[n],p.x=g*(p.x-h),p.y=m*(p.y-q)};ccNetViz.layout.random=function(a){this.apply=function(){for(var b=0,g=a.length;b<g;b++){var m=a[b];m.x=Math.random();m.y=Math.random()}}};
ccNetViz.layout.force=function(a,b){function g(a,b,h){var k=0,c=0;a.charge=0;if(!a.leaf)for(var w=a.nodes,f,e=w.length,l=0;l<e;l++)f=w[l],null!=f&&(g(f,b,h),a.charge+=f.charge,k+=f.charge*f.cx,c+=f.charge*f.cy);a.point&&(a.leaf||(a.point.x+=Math.random()-.5,a.point.y+=Math.random()-.5),b*=h[a.point.index],a.charge+=a.pointCharge=b,k+=b*a.point.x,c+=b*a.point.y);a.cx=k/a.charge;a.cy=c/a.charge}function m(a){return function(b,g,k,c){if(b.point!==a){k=b.cx-a.x;var w=b.cy-a.y;g=c-g;c=k*k+w*w;if(g*g/.64<
c)return Infinity>c&&(g=b.charge/c,a.px-=k*g,a.py-=w*g),!0;b.point&&c&&Infinity>c&&(g=b.pointCharge/c,a.px-=k*g,a.py-=w*g)}return!b.charge}}function h(){if(.05>(n*=.99))return n=0,!0;for(var h,t,v,k,c,w=a.length,f=b.length,e=0;e<f;e++)if(t=b[e],h=t.source,t=t.target,k=t.x-h.x,c=t.y-h.y,v=k*k+c*c)v=n*l[e]*((v=Math.sqrt(v))-p[e])/v,k*=v,c*=v,t.x-=k*(v=h.weight/(t.weight+h.weight)),t.y-=c*v,h.x+=k*(v=1-v),h.y+=c*v;if(v=.4*n)for(k=q[0]/2,c=q[1]/2,e=0;e<w;e++)t=a[e],t.x+=(k-t.x)*v,t.y+=(c-t.y)*v;g(h=ccNetViz.quadtree(a),
n,r);for(e=0;e<w;e++)t=a[e],!t.fixed&&h.visit(m(t));for(e=0;e<w;e++)t=a[e],t.fixed?(t.x=t.px,t.y=t.py):(t.x-=.9*(t.px-(t.px=t.x)),t.y-=.9*(t.py-(t.py=t.y)))}var q=[1,1],n,p=[],l=[],r=[];this.apply=function(){for(var g=a.length,m=Math.sqrt(g),q=.3/m,k=0;k<g;k++){var c=a[k];c.weight=0;c.x=void 0!==c.x?c.x:q+k%m/m;c.y=void 0!==c.y?c.y:q+Math.floor(k/m)/m;c.px=c.x;c.py=c.y;r[k]=-30}for(k=0;k<b.length;k++)c=b[k],c.source.weight++,c.target.weight++,p[k]=15,l[k]=1;for(n=.1;!h(););return!0}};
ccNetViz.layout.grid=function(a,b){function g(a,c,b){a=JSON.parse(JSON.stringify(a));a[c]=b;return a}function m(a,c){for(var b=0,f,e=0;e<a.length;e++)for(var g=0;g<e;g++)e!=g&&0!=c[e][g]&&(f=Math.abs(a[e][0]-a[g][0])+Math.abs(a[e][1]-a[g][1]),b=c[e][g]>=u?b+c[e][g]*f:b+c[e][g]*Math.min(f,t));return b}function h(a,c,b){for(var f=0,e,g=0;g<a.length;g++)0!=b[c][g]&&(e=Math.abs(a[c][0]-a[g][0])+Math.abs(a[c][1]-a[g][1]),f=b[c][g]>=u?f+b[c][g]*e:f+b[c][g]*Math.min(e,t));return f}function q(a){for(var c=
[],b=0;b<v;b++)for(var f=0;f<v;f++){var e=b+"_"+f;c[e]=[b,f]}for(b=0;b<a.length;b++)e=a[b][0]+"_"+a[b][1],delete c[e];return c}function n(a){for(var c=JSON.parse(JSON.stringify(a)),b={},f=0;f<a.length;f++)for(;;){var e=Math.floor(v*Math.random()),g=Math.floor(v*Math.random()),h=e+" "+g;if(!b[h]){b[h]=!0;c[f][0]=e;c[f][1]=g;break}}return c}function p(a,b,g,f){var e=0;0!=f[b][g]&&(d=Math.abs(a[b][0]-a[g][0])+Math.abs(a[b][1]-a[g][1]),e=f[b][g]>=u?e+f[b][g]*d:e+f[b][g]*Math.min(d,t));return e}function l(a,
b,m,f,e,l,n){var q,r=e[0]+"_"+e[1],t=m[0]+"_"+m[1];f==b?q=l[b][r]-l[b][t]:f!=b&&r!=a[b][0]+"_"+a[b][1]?(q=p(g(g(a,b,m),f,e),f,b,n),q-=p(g(a,b,m),f,b,n),q-=p(g(a,f,e),f,b,n),q+=p(a,f,b,n),q=l[f][r]+q):f!=b&&r==a[b][0]+"_"+a[b][1]&&(q=h(g(g(a,b,m),f,e),f,n),q-=h(g(a,b,m),f,n));return q}function r(b,c,n){R=JSON.parse(JSON.stringify(b));b=m(R,c);n=q(R);for(var f=0,e,p,r=0,t,v,u,A=[],E=0,B,x=0;x<a.length;x++){A[x]={};var y=h(R,x,c),z;for(z in n)u=n[z],A[x][z]=h(g(R,x,u),x,c),A[x][z]-=y,A[x][z]<E&&(E=A[x][z],
f=x,p=z,e=u)}for(;0>E;){y=[];for(x=B=0;x<a.length;x++){y[x]={};for(z in n)z!=p&&(u=n[z],y[x][z]=l(R,f,e,x,u,A,c),y[x][z]<B&&(B=y[x][z],r=x,v=z,t=u));z=R[f][0]+"_"+R[f][1];u=R[f];y[x][z]=l(R,f,e,x,u,A,c);y[x][z]<B&&(B=y[x][z],r=x,v=z,t=u)}y[f][R[f][0]+"_"+R[f][1]]=-E;n[R[f][0]+"_"+R[f][1]]=R[f];R=g(R,f,e);delete n[p];A=y;f=r;e=t;p=v;E=B}return[R,b+B]}var u=0,t=1,v=Math.floor(1.5*Math.sqrt(a.length));this.apply=function(){for(var g={},c=0;c<a.length;c++)g[a[c].label]=c;for(var h=[],f=0;f<a.length;f++){for(var e=
[],c=0;c<a.length;c++)e[c]=-2;h[f]=e}for(f=0;f<b.length;f++){for(c=0;c<b.length;c++)if(b[f].target.label==b[c].source.label){for(e=0;e<b.length;e++)if(b[c].target.label==b[e].source.label){for(var l=0;l<b.length;l++)b[e].target.label==b[l].source.label&&(h[g[b[f].source.label]][g[b[l].target.label]]=0,h[g[b[l].target.label]][g[b[f].source.label]]=0);h[g[b[f].source.label]][g[b[e].target.label]]=1;h[g[b[e].target.label]][g[b[f].source.label]]=1}h[g[b[f].source.label]][g[b[c].target.label]]=3;h[g[b[c].target.label]][g[b[f].source.label]]=
3}h[g[b[f].source.label]][g[b[f].target.label]]=5;h[g[b[f].target.label]][g[b[f].source.label]]=5}f=[];for(c=0;c<a.length;c++)f[c]=[0,0];e=[];for(c=0;10>c;c++)f=n(f),e[c]=m(f,h);for(var c=Math.max.apply(null,e),e=Math.min.apply(null,e),c=(c-e)/2,f=n(f),p=r(f,h,g),l=e=p[1],p=p[0];.1<c;){for(var t=0;10>t;t++){var u;u=JSON.parse(JSON.stringify(f));for(var D=q(u),A=0;A<u.length;A++){var E=u[A];if(.55>=Math.random())for(;;){var B=Math.floor(v*Math.random()),x=Math.floor(v*Math.random()),y=B+"_"+x;if(D[y]){E=
E[0]+"_"+E[1];delete D[y];D[E]=[B,x];u[A][0]=B;u[A][1]=x;break}}}D=r(f,h,g);Math.random()<Math.exp((e-D)/c)&&(e=D,f=u);e<l&&(l=e,p=f)}c*=.8}g=p;for(c=0;c<g.length;c++)a[c].x=g[c][0],a[c].y=g[c][1];return!0}};